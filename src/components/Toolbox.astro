---
import { Image } from 'astro:assets';

const stackItems = [
  {
    title: ".NET Core & Azure",
    subtitle: "Enterprise Backend Architecture",
    description: "Building scalable distributed systems with microservices, Event-Driven Architecture and cloud-native patterns on Azure, utilizing Service Bus for messaging and CosmosDB for high availability",
    size: "large", // col-span-2 row-span-2
    color: "from-blue-600/20 to-purple-600/20",
    icon: "server"
  },
  {
    title: "Angular & TypeScript",
    subtitle: "Modern Frontend",
    description: "Crafting responsive, type-safe SPAs with RxJS and clean component architecture.",
    size: "medium", // col-span-2 row-span-1
    color: "from-red-600/20 to-pink-600/20",
    icon: "code" 
  },
  {
    title: "SQL & MongoDB",
    subtitle: "Data Persistence",
    size: "small",
    color: "from-green-600/20 to-emerald-600/20",
    icon: "database"
  },
  {
    title: "Docker & Kubernetes",
    subtitle: "Containerization",
    size: "small",
    color: "from-cyan-600/20 to-blue-600/20",
    icon: "container"
  },
  {
    title: "TDD, xUnit, E2E",
    subtitle: "Quality Assurance",
    size: "small",
    description: "To ensure the quality of the code.",
    color: "from-teal-600/20 to-emerald-600/20",
    icon: "check"
  },
  {
    title: "CI/CD & DevOps",
    subtitle: "Automation",
    size: "small",
    color: "from-orange-600/20 to-amber-600/20",
    icon: "rocket"
  },
  {
    title: "SOLID & Clean Code",
    subtitle: "Design Principles",
    size: "medium", 
    description: "Obsessed with maintainability and software craftsmanship.",
    color: "from-slate-600/20 to-gray-600/20",
    icon: "shield"
  }
];

const getSizeClasses = (size: string) => {
  switch(size) {
    case 'large': return 'row-span-2 md:col-span-2 md:row-span-2 min-h-[400px]';
    case 'medium': return 'md:col-span-2 md:row-span-1 min-h-[200px]';
    case 'small': return 'md:col-span-1 md:row-span-1 min-h-[200px]';
    default: return 'md:col-span-1 md:row-span-1';
  }
};
---

<section id="toolbox" class="relative bg-dark text-white py-32 px-6 md:px-20">
  <div class="w-full max-w-[1800px]">
    <!-- Section Header -->
    <div class="flex flex-col md:flex-row justify-between items-end mb-16 gap-8">
      <div>
        <h2 class="text-primary font-medium tracking-widest uppercase mb-4 text-sm animate-on-scroll">The Toolbox</h2>
        <p class="font-display text-5xl md:text-7xl font-bold leading-tight animate-on-scroll delay-100">
          My Technical <span class="text-transparent bg-clip-text bg-linear-to-r from-white to-gray-500">Arsenal</span>
        </p>
      </div>
      <p class="text-gray-400 max-w-md text-lg text-right animate-on-scroll delay-200 hidden md:block">
        A curated selection of the technologies I use to build scalable, high-performance applications.
      </p>
    </div>

    <!-- Bento Grid -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 auto-rows-[200px]">
      {stackItems.map((item, index) => (
        <div 
          class={`group relative overflow-hidden rounded-3xl bg-white/5 border border-white/10 hover:border-white/20 transition-all duration-500 animate-on-scroll ${getSizeClasses(item.size)}`}
          style={`--delay: ${index * 100}ms`}
        >
          <!-- Dynamic Background Gradient -->
          <div class={`absolute inset-0 bg-linear-to-br ${item.color} opacity-0 group-hover:opacity-100 transition-opacity duration-700 ease-out`}></div>
          
          <!-- Content Container -->
          <div class="absolute inset-0 p-8 flex flex-col justify-between z-10">
            <!-- Header -->
            <div class="flex justify-between items-start">
              <div class="p-3 rounded-2xl bg-white/5 backdrop-blur-md border border-white/10 group-hover:scale-110 transition-transform duration-500">
                <!-- Simple Icons based on type -->
                {item.icon === 'server' && <svg class="w-6 h-6 text-blue-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M5 12h14M5 12a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v4a2 2 0 01-2 2M5 12a2 2 0 01-2 2v4a2 2 0 012 2h14a2 2 0 012-2v-4a2 2 0 01-2-2m-2-4h.01M17 16h.01" /></svg>}
                {item.icon === 'code' && <svg class="w-6 h-6 text-pink-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4" /></svg>}
                {item.icon === 'database' && <svg class="w-6 h-6 text-green-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4m0 5c0 2.21-3.582 4-8 4s-8-1.79-8-4" /></svg>}
                {item.icon === 'container' && <svg class="w-6 h-6 text-cyan-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4" /></svg>}
                {item.icon === 'rocket' && <svg class="w-6 h-6 text-orange-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M13.19 8.688a4.5 4.5 0 011.242 7.244l-4.5 4.5a4.5 4.5 0 01-6.364-6.364l1.757-1.757m13.35-.622l1.757-1.757a4.5 4.5 0 00-6.364-6.364l-4.5 4.5a4.5 4.5 0 001.242 7.244" /></svg>}
                {item.icon === 'shield' && <svg class="w-6 h-6 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" /></svg>}
                {item.icon === 'check' && <svg class="w-6 h-6 text-teal-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>}
              </div>

              {item.size === 'large' && (
                <div class="flex flex-wrap justify-end gap-2">
                   <span class="px-3 py-1 rounded-full bg-white/5 border border-white/10 text-xs text-gray-400">Microservices</span>
                   <span class="px-3 py-1 rounded-full bg-white/5 border border-white/10 text-xs text-gray-400">Event-Driven</span>
                   <span class="px-3 py-1 rounded-full bg-white/5 border border-white/10 text-xs text-gray-400">Application Insights</span>
                </div>
              )}
            </div>

            <!-- Text Content -->
            <div>
              <p class="text-sm text-gray-400 font-medium tracking-wider uppercase mb-2 group-hover:text-white/80 transition-colors">{item.subtitle}</p>
              <h3 class={`${item.size === 'large' ? 'text-4xl' : 'text-2xl'} font-display font-bold text-white mb-2 group-hover:translate-x-2 transition-transform duration-300`}>
                {item.title}
              </h3>
              
              {(item.description) && (
                <p class="text-gray-400 text-sm md:text-base leading-relaxed group-hover:text-gray-200 transition-colors mt-2">
                  {item.description}
                </p>
              )}
            </div>
          </div>
        </div>
      ))}
    </div>
  </div>
</section>

<script>
  function initProjects() {
    const observerOptions = {
      threshold: 0.1,
      rootMargin: "0px 0px -50px 0px"
    };

    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('in-view');
        } else {
          entry.target.classList.remove('in-view');
        }
      });
    }, observerOptions);

    document.querySelectorAll('.animate-on-scroll').forEach((el) => {
      observer.observe(el);
    });
  }

  // Run immediately
  initProjects();
</script>

<style>
  .animate-on-scroll {
    opacity: 0;
    transform: translateY(30px);
    transition: all 0.8s cubic-bezier(0.16, 1, 0.3, 1);
  }
  
  .animate-on-scroll.in-view {
    opacity: 1;
    transform: translateY(0);
  }

  /* Staggered delays for grid items */
  .project-card.in-view {
    transition-delay: var(--delay, 0ms);
  }

  .delay-100 { transition-delay: 100ms; }
  .delay-200 { transition-delay: 200ms; }
</style>
