---
const experiences = [
  {
    role: "Full-Stack Engineer",
    company: "GT Motive Spain",
    period: "Oct 2023 — Present",
    description: "Building and scaling an Azure microservices platform for automotive repair operations, with a strong focus on clean boundaries (Clean Architecture/SOLID) and reliable delivery through Azure DevOps CI/CD.",
    technologies: ["Azure", ".NET Core", "Angular", "Microservices"]
  },
  {
    role: "Backend Engineer",
    company: "AML Analytics",
    period: "Jan 2023 — Oct 2023",
    description: "Fortified codebase with comprehensive unit tests using AutoFixture. Successfully migrated applications from .NET Framework 4.8 to .NET 6, improving performance and maintainability.",
    technologies: [".NET 6", "C#", "AutoFixture", "Migration"]
  },
  {
    role: "Full-Stack Engineer",
    company: "atwork.",
    period: "Jul 2022 — Jan 2023",
    description: "Delivered production features in a mature app using Onion Architecture and Atomic Design, backed by a full testing strategy (unit, integration, and E2E) to keep releases stable.",
    technologies: ["Angular", "Onion Arch", "Atomic Design", "Entity Framework"]
  },
  {
    role: "Full-Stack Engineer",
    company: "Pam Learning",
    period: "Oct 2021 — Jul 2022",
    description: "Improved maintainability with clean code and Hexagonal Architecture practices while upgrading the stack (.NET 5→.NET 6) and migrating the frontend from vanilla TypeScript to Razor Pages.",
    technologies: [".NET 6", "Razor Pages", "TypeScript", "Hexagonal Arch"]
  },
  {
    role: "Full-Stack Developer - Intern",
    company: "CTI SL",
    period: "Nov 2020 — Sep 2021",
    description: "Maintained and extended a legacy VB/jQuery web app, and built strong SQL Server expertise by implementing complex stored procedures and functions to support core business logic.",
    technologies: ["Visual Basic", ".NET Framework", "jQuery", "SQL Server"]
  }
];
---

<section id="experience" class="bg-dark text-white relative">
  <div class="scroll-container h-screen w-full overflow-hidden flex flex-col justify-center relative">
      
      <!-- Static Header Overlay -->
      <div class="absolute top-12 left-6 md:left-20 z-20 pointer-events-none">
        <h2 class="text-primary font-medium tracking-widest uppercase mb-2 text-xs md:text-sm md:mb-4">Career Path</h2>
        <p class="font-display text-4xl md:text-6xl font-bold">
          Professional <span class="text-transparent bg-clip-text bg-linear-to-r from-white to-gray-500">Journey</span>
        </p>
      </div>
      
      <!-- The Moving Train of Cards -->
      <div class="cards-train flex items-center pl-[5vw] pr-[5vw] md:pl-[20vw] md:pr-[20vw] gap-[5vw] md:gap-[10vw] w-max">
        {experiences.map((exp, index) => (
          <div class="experience-card relative shrink-0 w-[90vw] md:w-[60vw] max-w-[800px] p-6 md:p-12 rounded-3xl bg-gray-900/80 border border-white/10 shadow-2xl">
            
            <!-- Glow Effect -->
            <div class="absolute -right-20 -top-20 w-64 h-64 bg-primary/10 rounded-full blur-3xl opacity-0 card-glow"></div>

            <div class="relative z-10 flex flex-col gap-6">
              <div class="flex items-center justify-between">
                <span class="px-4 py-2 text-sm font-bold tracking-wider text-primary uppercase bg-primary/10 rounded-full border border-primary/20">
                  {exp.period}
                </span>
                <span class="text-8xl font-display font-bold text-white/5 absolute -top-10 right-0 pointer-events-none">
                  0{index + 1}
                </span>
              </div>
              
              <div>
                <h3 class="text-3xl md:text-6xl font-display font-bold mb-2 text-white">{exp.role}</h3>
                <p class="text-xl md:text-2xl text-secondary font-light">{exp.company}</p>
              </div>

              <p class="text-gray-300 text-lg md:text-xl leading-relaxed max-w-3xl">
                {exp.description}
              </p>

              <!-- Tech Stack -->
              <div class="flex flex-wrap gap-3 mt-4">
                {exp.technologies.map(tech => (
                  <span class="px-4 py-2 text-sm bg-black/30 text-gray-400 rounded-lg border border-white/5">
                    {tech}
                  </span>
                ))}
              </div>
            </div>
          </div>
        ))}
      </div>
  </div>
</section>

<script>
  import { gsap } from "gsap";
  import { ScrollTrigger } from "gsap/ScrollTrigger";

  gsap.registerPlugin(ScrollTrigger);

  function initExperience() {
    const container = document.querySelector('.scroll-container');
    const train = document.querySelector('.cards-train');
    
    if (!container || !train) return;

    const cards = gsap.utils.toArray('.experience-card');
    
    // Calculate total scroll distance
    const getScrollAmount = () => {
      // Helper to ensure we scroll the entire width
      return -(train.scrollWidth - window.innerWidth);
    };

    const tween = gsap.to(train, {
      x: getScrollAmount,
      ease: "none",
      scrollTrigger: {
        trigger: container,
        pin: true,
        start: "top top",
        scrub: 1,
        // Scroll distance based on width of content ensures consistent speed
        end: () => "+=" + (train.scrollWidth - window.innerWidth), 
        invalidateOnRefresh: true,
        onUpdate: (self) => {
          // Subtle parallax/focus effect for cards
          const centerScreen = window.innerWidth / 2;
          
          cards.forEach((card: any) => {
            const rect = card.getBoundingClientRect();
            const cardCenter = rect.left + rect.width / 2;
            const distFromCenter = Math.abs(centerScreen - cardCenter);
            
            // Calculate intensity (0 to 1) based on distance
            // Wider range of effect for smoother feel
            let intensity = 1 - (distFromCenter / (window.innerWidth * 0.6));
            intensity = Math.max(0, Math.min(intensity, 1));
            
            const scale = 0.9 + (0.1 * intensity); // 0.9 -> 1.0
            const opacity = 0.4 + (0.6 * intensity); // 0.4 -> 1.0
            
            gsap.set(card, { 
              scale: scale, 
              opacity: opacity,
              zIndex: distFromCenter < 200 ? 10 : 1
            });
            
            const glow = card.querySelector('.card-glow');
            if (glow) {
              gsap.set(glow, { opacity: intensity * 0.5 });
            }
          });
        }
      }
    });
  }

  // Defer slightly to ensure layout is ready
  // GSAP handles resize automatically via ScrollTrigger.refresh()
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initExperience);
  } else {
    initExperience();
  }
</script>

<style>
  .experience-card {
    /* Base styles */
  }
</style>
